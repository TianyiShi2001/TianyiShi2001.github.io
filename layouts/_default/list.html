{{ define "main" }}

<main class="content {{ .Page.Kind }}" role="main">
  

  <article class="article">
    {{ if .Title }}
      <h1 class="article-title">{{ .Title }}</h1>
    {{ end }}
    <div class="article-content">
      {{ .Content }}
    </div>
  </article>

  <div class="archive">
    {{ $pages := .Pages }}
    {{ $listishome := .IsHome }}
    {{ if $listishome }}
      {{ $pages = .Site.RegularPages }}
      {{ range (where $pages "Section" "!=" "").GroupByDate "2006" }}
       {{ $page := index .Pages 0 }}
       {{ if le $page.Date.Year 2020 }}
        <h2 class="archive-title">{{ .Key }}</h2>
          {{ range .Pages.GroupByParam "term" "desc"}}
          <h3 class="archive-subtitle">{{ substr .Key 2 }} Term</h3>
            {{ range .Pages }}
              <article class="archive-item">
                <a href="{{ .RelPermalink }}" class="archive-item-link" onmouseover="fetchAndAppend(this)">
                  {{ if $listishome }}
                    {{ replace (.Section | title) "-" " " }}:
                  {{ end }}
                  {{ .Title }} 
                </a>
                <span class="archive-item-date">
                  Week {{ .Params.week }}
                </span>
                <div class="article-summary" style="display: none;">
                  {{ with .Params.summary }}
                    {{ . }}<hr>
                  {{ end }}
                </div>
              </article>
            
            {{ end }}
            
          {{ end }}
          {{ else }}
              <h2 class="archive-title">{{ .Key }}</h2>
              {{ range .Pages }}
                <article class="archive-item">
                  <a href="{{ .RelPermalink }}" class="archive-item-link">
                    {{ .Title }} 
                  </a>
                  <span class="archive-item-date">
                    {{ .Date.Format "2006-01-02" }}
                  </span>
                  <div class="article-summary" style="display: none;">
                    {{ with .Params.summary }}
                      {{ . }}<hr>
                    {{ end }}
                    {{ .Content }}
                  </div>
                </article>
              {{ end }}
        {{ end }}
      {{ end }}
      <div id="about">
        {{ with .Site.GetPage "/about.md" }}
          {{ .Content }}
        {{ end }}
      </div>
    {{ else }}
      {{ range (where $pages "Section" "!=" "").GroupByDate "2006" }}
      <h2 class="archive-title">{{ .Key }}</h2>
          {{ range .Pages }}
            <article class="archive-item">
              <a href="{{ .RelPermalink }}" class="archive-item-link">
                {{ .Title }} 
              </a>
              <span class="archive-item-date">
                {{ .Date.Format "2006-01-02" }}
              </span>
              <div class="article-summary" style="display: none;">
                {{ with .Params.summary }}
                  {{ . }}<hr>
                {{ end }}
                {{ .Content }}
              </div>
            </article>
          {{ end }}
      {{ end }}
    {{ end }}
  </div>

</main>

<script src="{{ "/js/list.js" | relURL }}"></script>

{{ end }}